<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <!-- {{.Title}} -->
    <canvas id="canvas" width="800" height="600">

    </canvas>
    <script src="src/graphics.js">
        
    </script>
    <script src="src/engine.js"></script>
    <script>

        var graphics = new Graphics("canvas");
        graphics.getGL();
        
        class GLDraw extends KairaEngine.Component{
            constructor(Projectile = new KairaEngine.Projectile){
                super();
                this.Projectile = Projectile;
            }
            update(Projectile){
                graphics.setShaders();
                graphics.setBuffers({
                    position: {
                        numberOfComponents: 3, // X and Y ordered pair coordinates
                        data: new Float32Array([
                            (0.0 * this.Projectile.transform.scale.x) + this.Projectile.transform.position.x, (0.5 * this.Projectile.transform.scale.y) + this.Projectile.transform.position.y, 0,
                            (-0.5 * this.Projectile.transform.scale.x) + this.Projectile.transform.position.x, (-0.5 * this.Projectile.transform.scale.y) + this.Projectile.transform.position.y, 0,
                            (0.5 * this.Projectile.transform.scale.x) + this.Projectile.transform.position.x, (-0.5 * this.Projectile.transform.scale.y) + this.Projectile.transform.position.y, 0,
                        ])
                    },
                    color: { 
                        numberOfComponents: 3, // RGB triple
                        data: new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1])
                    }
                });
                graphics.use();
                //console.log(123);
            }
        }

        var a = new KairaEngine.Vector2();
        var b = new KairaEngine.Vector2(1,2);
        //{{.}}
        var i = 0;
        var p1 = new KairaEngine.Projectile(new KairaEngine.Transform(
            new KairaEngine.Vector2(-1,0),
            new KairaEngine.Vector2(.5,.5)
        ));
        p1.components = [
            new KairaEngine.Rigidbody(
                Projectile = p1,
                velocity = new KairaEngine.Vector2(1,0),
                accelation = new KairaEngine.Vector2(0,0)
            ),
            new KairaEngine.Collider.SphereCollider(
                Projectile = p1,
                .1
            ),
        ];
        var p2 = new KairaEngine.Projectile(new KairaEngine.Transform(
            new KairaEngine.Vector2(1,0),
            new KairaEngine.Vector2(.5,.5)
        ));
        p2.components = [
            new KairaEngine.Rigidbody(
                Projectile = p2,
                velocity = new KairaEngine.Vector2(-1,0),
                accelation = new KairaEngine.Vector2(0,0)
            ),
            new KairaEngine.Collider.SphereCollider(
                Projectile = p2,
                .1
            ),
        ];

        p1.addComponent(new GLDraw(p1));
        p2.addComponent(new GLDraw(p2));
        KairaEngine.update = function(){
            graphics.clearColor();
            /*
            KairaEngine.Graphics = new Graphics("canvas");
            KairaEngine.Graphics.getGL();
            KairaEngine.Graphics.clearColor();
            */
            /*
            if (!p1.components[0].onCollisionEnter(p2.components[0])){
                p1.update();
                p2.update();

            //console.log(p1.components[0].onCollisionEnter(p2.components[0]));
            }
            else {
                console.log(31);
            }
            */
            
           
           if (p1.components[1].onCollisionEnter(p2.components[1])){
                p1.components[0].velocity = p1.components[0].velocity.multiple(-1);
                p1.components[0].accelation = p1.components[0].accelation.multiple(-1);

                p2.components[0].velocity = p2.components[0].velocity.multiple(-1);
                p2.components[0].accelation = p2.components[0].accelation.multiple(-1);
            }
            else {
                console.log(p1.transform.position.distance(p2.transform.position));
                console.log(p1.components[0].onCollisionEnter(p2.components[0]));
                var aa = p1.components[0].onCollisionEnter(p2.components[0]);
                console.log(a);
                p1.update();
                p2.update();
            }
            /*
            graph.setBuffers({
                position: {
                    numberOfComponents: 2, // X and Y ordered pair coordinates
                    data: new Float32Array([
                        0.0 , 0.5 + i, -0.5 + i,
                        -0.5 + i, 0.5 + i, -0.5 + i
                    ])
                },
                color: { 
                    numberOfComponents: 3, // RGB triple
                    data: new Float32Array([
                        1, 0, 0,
                        0, 1, 0,
                        0, 0, 1
                    ])
                }
            });
            graph.use();
            */
            i += KairaEngine.deltaTime;
            a = a.add(b.multiple(i));
            /*console.log({
                "a":a,
                "b":b,
                "i":i
            });*/
        }
        
        
       
    </script>
</body>
</html>